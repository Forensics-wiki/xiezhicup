"use strict";var vm=new Vue({el:".banner",data:function(){return{in:0,jtype_id:"季赛",enroll_id:0,team_id:0,showSign:!1,sign_type:1,title:"立即报名",is_read:!1,noticeList:[],enroList:[],disabled:!1,disbtn:!1,bm_code:"",sinupForm:{tableList:[]},teamData:{},teamList:[],fieldList:[],enroll_time:"",errorTxt:"",isMobile:!1,dis_query:!0,isPc:!1,isIcq:!0,max_user_i:0,showSignup:!1,showQuery:!1,matchBtn:[],matchBtn1:[]}},created:function(){this.getButton(),this.getEnrollList(),navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)?this.isPc=!1:this.isPc=!0,location.host&&(-1<location.host.indexOf("ichunqiu")||(this.isIcq=!1,$(".header_right").hide()))},methods:{getButton:function(){var e=this;$.fn_ajax({url:base_url+"api/option/button_lists",options:{page_index:"",page_size:"",k:url_key},callBack:function(i){0==i.code&&(e.matchBtn=[],e.matchBtn1=i.data.lists,i.data.lists&&i.data.lists.forEach(function(i){1==i.type_id?e.showSignup=i.title:3==i.type_id?e.showQuery=i.title:e.matchBtn.push(i)}))}})},submit:function(){var n=this;this.$refs.teamDataRef.validate(function(i){i&&$.fn_ajax({url:base_url+"api/signup/enroll_time",options:{enroll_id:n.enroll_id,k:url_key},callBack:function(i){0==i.code?mask_img_yzm(function(i){var e,t,s,a;n.bm_code=i.find("input").val(),4==n.bm_code.length&&(i.remove(),n.sinupForm.tableList.map(function(i){return i.id=i.id?i.id:0,i}),1==n.enroList[n.max_user_i].max_user_num&&(n.sinupForm.tableList[0].user_type=2),e=JSON.parse(JSON.stringify(n.sinupForm.tableList)),t=["phone","email","id_number"],e.map(function(i){for(var e=0;e<t.length;e++)i[t[e]]&&(i[t[e]]=fn_login_encryption(i[t[e]]));return i}),s={enroll_id:n.enroll_id,team_id:n.team_id,bm_code:n.bm_code,user_list:e,k:url_key},a=Object.assign(n.teamData,s),$.fn_ajax({url:base_url+"api/signup/submit_info",options:a,callBack:function(i){0==i.code?n.$message({message:i.message,type:"success",duration:3e3,onClose:function(){window.location.reload()}}):n.errorMsg(i.message)}}))}):n.errorMsg(i.message)}})})},addRow:function(i,e){if(i){if(this.sinupForm.tableList.length>=this.enroList[this.max_user_i].max_user_num)return!1;this.sinupForm.tableList.push({})}else this.sinupForm.tableList.splice(e,1)},teamChange:function(i,e){"province_id"!=e.code&&"city_id"!=e.code||this.getCityFn(i,e.code)},typeChange:function(i){this.max_user_i=i,this.getList(),2==this.sign_type?(this.sinupForm.tableList=[],this.queryTeam()):(this.teamData={},this.$refs.teamDataRef&&this.$refs.teamDataRef.resetFields(),this.sinupForm.tableList=[{}])},getList:function(){var e=this;$.fn_ajax({url:base_url+"api/signup/field_lists",options:{enroll_id:this.enroll_id,k:url_key},callBack:function(i){0==i.code?(i.data.lists&&i.data.lists.length&&"user_type"==i.data.lists[0].code&&(9!=e.enroll_id&&10!=e.enroll_id&&11!=e.enroll_id||(i.data.lists[0].isHiddenUserType=!0)),e.fieldList=[],e.teamList=[],e.teamList=i.data.lists.filter(function(i){return 1==i.category}),e.fieldList=i.data.lists.filter(function(i){return 2==i.category}).map(function(i){return"phone"==i.code||"user_name"==i.code?(i.width=140,9!=e.enroll_id&&10!=e.enroll_id&&11!=e.enroll_id||(i.width=130)):"id_number"==i.code?i.width=210:"email"==i.code?i.width=150:"user_sex"==i.code||"user_type"==i.code?i.width=120:(i.width=150,9!=e.enroll_id&&10!=e.enroll_id&&11!=e.enroll_id||(i.width=120)),i}),e.teamList.forEach(function(i,e){"city_id"!=i.code&&"area_id"!=i.code||(i.original=[])})):(e.teamList=[],e.fieldList=[])}})},getCityFn:function(i,s,a){var n=this;$.fn_ajax({url:base_url+"api/option/province_lists",options:{enroll_id:this.enroll_id,parent_id:i,k:url_key},callBack:function(t){0==t.code&&n.teamList.forEach(function(i,e){"province_id"==s&&"city_id"==i.code?(i.original=t.data,a||n.$set(n.teamData,"city_id",i.original[0].id),n.getCityFn(n.teamData.city_id,"city_id",a?"city":"")):"city_id"==s&&"area_id"==i.code&&(i.original=t.data,a||n.$set(n.teamData,"area_id",i.original[0].id))})}})},signUp:function(i){var e=this;if(this.isIcq)if(this.enroll_id=this.enroList.length&&this.enroList[0].id,this.sign_type=i,user_id){if(!this.enroll_id)return;if(isMobile)1==i?$.fn_ajax({url:base_url+"api/signup/subject_time",options:{k:url_key},callBack:function(i){0==i.code?window.location.href=base_url+"notice?k="+url_key:e.$message.error(i.message)}}):this.queryTeam();else if(1==i)this.disabled=!1,this.disbtn=!1,$.fn_ajax({url:base_url+"api/signup/subject_time",options:{k:url_key},callBack:function(i){0==i.code?e.getNotice():e.$message.error(i.message)}});else{if(!this.dis_query)return;this.dis_query=!1,this.disabled=!0,this.disbtn=!0,this.sinupForm.tableList=[],this.queryTeam(),setTimeout(function(){e.showSign=!0,e.dis_query=!0},1e3)}}else isMobile?window.location.href=base_url+"login?k="+url_key:createLogin(vuelogin);else window.open("http://bm.ichunqiu.com/hxb")},close:function(){$(".noticeBox").hide(),this.is_read=!1},nextStep:function(){this.is_read?($(".noticeBox").hide(),this.showSign=!0,this.is_read=!1,this.sinupForm.tableList=[{}],9!=this.enroll_id&&10!=this.enroll_id&&11!=this.enroll_id||(this.sinupForm.tableList[0].isHiddenUserType=!0,this.sinupForm.tableList[0].user_type=2),this.teamData={},this.teamList.forEach(function(i,e){"city_id"!=i.code&&"area_id"!=i.code||(i.original=[])})):this.$message.error("请阅读报名须知并勾选已阅读")},removeSign:function(){location.reload()},getNotice:function(){var e=this;$.fn_ajax({url:base_url+"api/option/notice_lists",options:{page_index:"",page_size:"",k:url_key},callBack:function(i){0==i.code&&(e.noticeList=i.data.lists,$(".noticeBox").show())}})},getEnrollList:function(){var e=this;$.fn_ajax({url:base_url+"api/option/enroll_lists",options:{page_index:"",page_size:"",k:url_key},callBack:function(i){0==i.code&&(e.enroList=i.data.lists.map(function(i,e){return i.max_user_num=parseInt(i.max_number)+parseInt(i.max_leader)+parseInt(i.max_teacher)+1,i}),e.enroll_id=e.enroList.length&&e.enroList[0].id,e.getList())}})},queryTeam:function(){var e=this;$.fn_ajax({url:base_url+"api/signup/team_detail",options:{enroll_id:this.enroll_id,k:url_key},callBack:function(i){if(0==i.code){if(isMobile)return window.location.href=base_url+"common?k="+url_key+"&enroll_id="+e.enroll_id+"&source=2&team_id="+i.data.team_id,!1;e.team_id=i.data.team_id,e.disabled=!i.data.allow_edit,e.disbtn=!i.data.allow_edit,i.data.lists.forEach(function(i){e.$set(e.teamData,i.code,"text"==i.type?i.text_value:i.select_value)}),e.teamData.province_id&&e.getCityFn(e.teamData.province_id,"province_id","city"),e.queryMember()}else{if(isMobile)return window.location.href=base_url+"common?k="+url_key+"&enroll_id="+e.enroll_id+"&source=2&team_id=0",!1;e.disabled=!1,e.disbtn=!0,e.team_id=0,e.sinupForm.tableList=[],e.teamData={},e.$refs.teamDataRef&&e.$refs.teamDataRef.resetFields()}}})},queryMember:function(){var e=this;$.fn_ajax({url:base_url+"api/signup/user_lists",options:{enroll_id:this.enroll_id,team_id:this.team_id,k:url_key},callBack:function(i){0==i.code?e.queryMemberDetail(i.data,0):e.sinupForm.tableList=[]}})},queryMemberDetail:function(t,s){var a=this;$.fn_ajax({url:base_url+"api/signup/user_detail",options:{enroll_id:this.enroll_id,team_id:this.team_id,uid:t[s].id,k:url_key},callBack:function(i){if(0==i.code){var e={};if(i.data.lists.forEach(function(i){e.id=t[s].id,e.education_id=0!=e.education_id?e.education_id:"",a.$set(e,i.code,"text"==i.type?i.text_value:i.select_value)}),a.sinupForm.tableList.push(e),++s>=t.length)return!1;a.queryMemberDetail(t,s)}}})},errorMsg:function(i,e){var t=this;this.errorTxt=i;var s=setTimeout(function(){t.errorTxt="",clearTimeout(s)},e||2e3)}}});